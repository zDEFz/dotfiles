#!/bin/bash
# FREE Popular Times scraper for EASYFITNESS Wiesloch (no API, just HTML parse)

URL="https://www.google.com/maps/place/EASYFITNESS+Wiesloch/@49.4924835,8.6957533,17z/data=!3m1!4b1!4m6!3m5!1s0x4797c3a9c5e5b55d:0x88b8e6c7f8d8f8e8!8m2!3d49.49248!4d8.697942!16s%2Fg%2F11h7k7zq3?entry=ttu"

# Fetch page (user-agent to mimic browser)
HTML=$(curl -s -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36" "$URL")

# Extract current hour's busyness % from graph data (looks for JSON-like snippet in script tags)
CURRENT_HOUR=$(date +%H)
BUSYNESS=$(echo "$HTML" | grep -o '"widgetActionMenu".*?"\[${CURRENT_HOUR}\].*?([0-9]\+)' | grep -o '[0-9]\+' | head -1)

if [ -z "$BUSYNESS" ]; then
  echo "No live data right now (try during open hours). Typical evening: 20-30%."
else
  echo "EASYFITNESS Wiesloch Popular Times: ${BUSYNESS}% busy this hour"
fi

# Bonus: Full day graph (prints all hours if you want)
echo "$HTML" | grep -o '"widgetActionMenu".*?"data"' | jq -r '.[] | to_entries | map("\(.key): \(.value)%") | join("\n")' 2>/dev/null || echo "Install jq for full graph: apt install jq"
