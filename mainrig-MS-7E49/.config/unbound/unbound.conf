server:
    # --- Basic Setup ---
    verbosity: 1
    interface: 127.0.0.1
    port: 53
    do-ip4: yes
    do-udp: yes
    do-tcp: yes
    
    # Use all CPU cores (Matches your high-spec rig)
    num-threads: 8
    so-reuseport: yes

    # --- RAM Power Settings (Utilizing your 186GB) ---
    # Massive caches to ensure the internet "phonebook" stays in RAM
    msg-cache-size: 1G
    rrset-cache-size: 2G
    
    # Slabs should be a power of 2 close to num-threads to reduce lock contention
    msg-cache-slabs: 8
    rrset-cache-slabs: 8
    key-cache-slabs: 8
    infra-cache-slabs: 8
    
    # Buffer spikes on your 1Gbps line
    so-rcvbuf: 8m
    so-sndbuf: 8m

    # --- Aggressive "0 msec" Speed Hacks ---
    # Prefetch records before they expire to keep the cache "hot"
    prefetch: yes
    prefetch-key: yes
    
    # Force records to stay in RAM for at least 1 hour
    cache-min-ttl: 3600
    cache-max-ttl: 86400

    # THE MAGIC COMBO FOR 0ms: Serve expired data instantly while updating in BG
    serve-expired: yes
    serve-expired-ttl: 86400        # Keep expired records in RAM for 24h
    serve-expired-client-timeout: 0 # ZERO delay; don't wait for validation
    serve-expired-reply-ttl: 30    # Tell browser to re-check in 30s
    
    # --- Privacy & Security ---
    hide-identity: yes
    hide-version: yes
    harden-glue: yes
    harden-dnssec-stripped: yes
    qname-minimisation: yes
    use-caps-for-id: yes
    
    # Access Control
    access-control: 127.0.0.0/8 allow

    # --- Paths ---
    directory: "/etc/unbound"
    username: "unbound"
    auto-trust-anchor-file: "/etc/unbound/root.key"

# Optional: If you want to forward to Mullvad specifically
forward-zone:
   name: "."
   forward-addr: 10.64.0.1 # Mullvad's internal DNS
